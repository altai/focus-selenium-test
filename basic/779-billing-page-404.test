Feature: Test billing 404

  Scenario: Setup prerequisites
    Require setup " login "

  Scenario: Create network
    Given I open page "/"
    When I click top menu "Global administration"
    When I click project menu item "Networks"
    Then I see project menu item "Networks" active
    And I click button "Add"
    And I type "{{ networks.0.CIDR }}" in field "CIDR"
    And I type "{{ networks.0.VLAN }}" in field "VLAN"
    And I click button "Create"
    Then I see success notification "Network net{{ networks.0.VLAN }} created."

  Scenario: Add project
    Given I open page "/"
    When I click top menu "Global administration"
    Then I see page header "Global administration: Virtual machines"
    When I click project menu item "Projects"
    And I click button "Add"
    And I type "{{ projects.0.name }}" in field "Name"
    And I select "net{{ projects.0.net }} ({{ projects.0.CIDR }}, {{ projects.0.net }})" in field "Network"
    And I click button "Create"
    

  Scenario: Add user to project
    When I click project menu item "Users"
    And I click "{{ projects.0.users.0 }}" in line containing "{{ projects.0.users.0 }}", row "Username"
    And I select "{{ projects.0.name }}" in field "Add Project"
    And I click button "Add"

  Scenario: Upload image
    Given I open page "/"
    When I click top menu "Global administration"
    And I click project menu item "Images"
    And I click button "Add"
    And I click radio button "Solid" in field "Upload type"
    And I type "{{ image.name }}" in field "Name"
    And I select file "{{ image.path }}" in "uploader"
    And I click radio button "qcow2" in field "Disk format"
    And I click button "Add"
    I wait 20 seconds

  Scenario: Start instance
    When I click top menu "Dashboard"
    And I click "{{ projects.0.name }}" in line containing "{{ projects.0.name }}", row "Project name"
    And I click project menu item "Virtual Machines"
    When I click button "Add"
    And I select "{{ image.name }}" in field "Image"
    And I select "{{ instance.flavor }}" in field "Flavor"
    And I type "{{ instance.name }}" in field "Name"
    And I click button "Spawn it"
    Then I see success notification "Virtual machine spawned."
    And I see page header "{{ projects.0.name }}: Virtual Machines"
    I refresh page until I see "ACTIVE" in line containing "{{ instance.name }}"

  Scenario: Remove instance
    When I click "delete" in line containing "{{ instance.name }}", row "Actions"
    And I see modal dialog "Confirmation request" contains "Sure to delete VM "{{ instance.name }}""
    And I click modal dialog button "Yes, delete"
    And I wait 10 seconds

  Scenario: Remove image
    Given I open page "/"
    When I click top menu "Global administration"
    When I click project menu item "Images"
    When I click "delete" in line containing "{{ image.name }}", row "Actions"
    And I click modal dialog button "Yes, delete"

  Scenario: Remove user from project
    Given I open page "/"
    When I click top menu "Global administration"
    And I click project menu item "Users"
    And I click "{{ projects.0.users.0 }}" in line containing "{{ projects.0.users.0 }}", row "Username"
    And I click button "Remove"

  Scenario: Remove project
    When I click project menu item "Projects"
    When I click "delete" in line containing "{{ projects.0.name }}", row "Actions"
    And I click modal dialog button "Yes, delete"

  Scenario: Remove network
    When I click project menu item "Networks"
    When I click "delete" in line containing "{{ networks.0.VLAN }}", row "Actions"
    And I click modal dialog button "Yes, delete"

  Scenario: Click billing
    Given I open page "/"
    When I click top menu "Global administration"
    When I click project menu item "Billing"
    Then I see project menu item "Billing" active
